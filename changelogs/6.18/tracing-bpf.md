# Linux 6.18 트레이싱 & BPF 변경사항

> 출처: kernelnewbies.org, LWN.net
> 릴리스: Linux 6.18
> 작성일: 2026-02-10

---

## 개요

Linux 6.18 BPF의 핵심은 프로그램 암호화 서명 인프라 도입이다. bpf_task_work를 통한 태스크 컨텍스트 지연 실행, 검증기의 경로 비민감 라이브 스택 분석, union 인수 지원 등 검증기 및 런타임 개선도 포함되었다.

---

## BPF 서명 프로그램

### 변경사항
- **암호화 서명 인프라** — BPF 프로그램에 대한 암호화 서명 메커니즘 도입
- **보안 정책 기반** — 서명된 프로그램만 로드를 허용하는 보안 정책 구현 가능
- **비특권 사용자 로딩 기반** — 검증(서명)된 BPF 프로그램을 비특권 사용자가 로드할 수 있는 경로의 기술적 기반

### 배경 및 영향
- BPF의 CO-RE(Compile Once - Run Everywhere) 특성상 사용자 공간에서 재배치가 적용되어 원본 서명이 무효화되는 근본적 문제 존재
- 두 가지 접근법이 2025년 BPF 서밋에서 논의:
  - **Hornet LSM**: 경량 스켈레톤 로더를 커널 내에서 실행하여 재배치를 커널 컨텍스트에서 수행, 서명 유효성 유지
  - **2단계 서명**: 원본 + 재배치 후 이중 서명으로 신뢰 체인 구축
- Microsoft Azure의 약 80만 장의 eBPF 네트워킹 카드에서 프로비넌스(출처) 검증 요구사항이 주요 동기
- 커널 모듈 서명과 유사한 보안 수준을 BPF 프로그램에 적용하는 장기 프로젝트의 시작

---

## bpf_task_work 인터페이스

### 변경사항
- **태스크 컨텍스트 지연 실행** — BPF 프로그램에서 태스크 컨텍스트로 실행을 스케줄링하는 새 인터페이스
- **비슬리퍼블 컨텍스트 호출 가능** — NMI 등 슬립 불가능한 컨텍스트에서도 태스크 작업 스케줄링
- **슬리퍼블 서브프로그램 실행** — 스케줄된 작업은 태스크 컨텍스트에서 슬리퍼블하게 실행 가능

### 배경 및 영향
- 기존에는 NMI/하드 인터럽트 등 제한된 컨텍스트에서 BPF 프로그램이 슬리퍼블 연산을 수행할 수 없었음
- bpf_task_work는 이러한 제한을 우회하여 지연 실행으로 슬리퍼블 연산을 태스크 컨텍스트에서 수행
- 모니터링, 프로파일링, 보안 감사 등에서 더 풍부한 BPF 프로그램 작성 가능

---

## 검증기 개선

### 변경사항
- **경로 비민감 라이브 스택 분석** — 기존 경로 민감(path-sensitive) 분석을 경로 비민감(path-insensitive) 분석으로 전환
- **Union 인수 지원** — 트램폴린 기반 BPF 프로그램에서 union 타입 인수 지원
- **Arena 서명된 로드** — arena 메모리에서 서명된(signed) 로드 지원

### 배경 및 영향
- 경로 비민감 분석은 검증기의 복잡도를 줄이면서 동일한 안전성 보장 달성을 목표
- Union 지원은 더 많은 커널 함수에 BPF 트램폴린을 부착할 수 있게 하여 추적 범위 확대
- Arena 서명 로드는 arena 메모리 접근의 타입 안전성 향상

---

## 새 BPF 기능

### bpf_strcasecmp kfunc
- 대소문자를 무시하는 문자열 비교 함수. BPF 프로그램에서 문자열 매칭 유연성 향상

### skb 메타데이터 dynptr
- **TC BPF용 새 dynptr 타입** — tc(Traffic Control) BPF 프로그램에서 skb 메타데이터에 dynptr로 접근 가능
- 패킷 메타데이터의 안전한 접근 패턴 제공

### Arena 폴트 보고
- **BPF 스트림 알림** — arena 폴트 발생 시 BPF 스트림으로 알림 전달
- arena 메모리의 디버깅 및 모니터링 강화

---

## 이전 버전과의 연속성

- **BPF 보안**: 6.16 BPF qdisc(네트워크 스케줄러 프로그래밍) → 6.18 BPF 서명 프로그램(보안 정책 기반). BPF의 프로그래밍 범위와 보안성이 동시 확대
- **검증기**: 매 릴리스마다 검증기 개선 지속. 6.18의 경로 비민감 분석은 검증 복잡도 감소
- **BPF 런타임**: 6.16의 rbtree 순회/list peek → 6.18 bpf_task_work + arena 서명 로드. 런타임 기능 지속 확대
- **BPF signing**: 커널 모듈 서명에 이어 BPF 프로그램 서명 인프라 도입. 비특권 BPF 로딩의 보안 기반 마련

---

## 참고 자료

- [kernelnewbies.org — Linux 6.18](https://kernelnewbies.org/Linux_6.18)
- [LWN.net — Code signing for BPF programs](https://lwn.net/Articles/1017549/)
- [Phoronix — Linux 6.18 Released](https://www.phoronix.com/news/Linux-6.18-Released)
